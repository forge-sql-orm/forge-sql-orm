modules:
  jira:globalPage:
    - key: forge-sql-orm-example-hello-world-page
      resource: main
      resolver:
        function: resolver
      title: Forge SQL ORM AtlasCamp
  scheduledTrigger:
    - key: scheduled-schema-migration
      function: runSchemaMigration
      interval: day
    - key: runSlowQuery
      function: runSlowQueryFunc
      interval: day
    - key: clear-cache-trigger
      function: clearCache
      interval: fiveMinute
  trigger:
    - key: post-install-schema-migration
      function: runSchemaMigration
      events:
        - avi:forge:installed:app
  consumer:
    - key: print-degradation-queries
      queue: degradationQueue
      function: handlerAsyncDegradation
    - key: runSchemaMigrationQueue
      queue: migrationQueue
      function: handlerAsyncMigration
#  webtrigger:
#    - key: invoke-schema-migration
#      function: runSchemaMigration
#    - key: fetch-schema
#      function: fetchSchema
  sql:
    - key: main
      engine: mysql
  function:
    - key: resolver
      handler: index.handler
    - key: runSchemaMigration
      handler: index.handlerMigration
    - key: dropMigrations
      handler: index.dropMigrations
    - key: fetchSchema
      handler: index.fetchMigrations
    - key: runSlowQueryFunc
      handler: index.runSlowQuery
    - key: clearCache
      handler: index.clearCache
    - key: handlerAsyncDegradation
      handler: index.handlerAsyncDegradation
    - key: handlerAsyncMigration
      handler: index.handlerAsyncMigration
      timeoutSeconds: 900
resources:
  - key: main
    path: static/forge-orm-example/build-static
    tunnel:
      port: 3099
app:
  runtime:
    name: nodejs24.x
  id: ari:cloud:ecosystem::app/e20d4dfb-bbb1-4526-9110-2b635aa35275
  storage:
    entities:
      - name: cache
        attributes:
          sql:
            type: string
          expiration:
            type: integer
          data:
            type: string
        indexes:
          - sql
          - expiration
permissions:
  content:
    styles:
      - "unsafe-inline"
  scopes:
    - "storage:app"
